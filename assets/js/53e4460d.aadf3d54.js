"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8270],{8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(6540);const t={},a=r.createContext(t);function l(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(a.Provider,{value:n},e.children)}},9732:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"usage/release-pr","title":"release-pr","description":"The release-plz release-pr command runs release-plz update and","source":"@site/docs/usage/release-pr.md","sourceDirName":"usage","slug":"/usage/release-pr","permalink":"/docs/usage/release-pr","draft":false,"unlisted":false,"editUrl":"https://github.com/release-plz/release-plz/tree/main/website/docs/usage/release-pr.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"update","permalink":"/docs/usage/update"},"next":{"title":"release","permalink":"/docs/usage/release"}}');var t=s(4848),a=s(8453);const l={},i="release-pr",o={},c=[{value:"PR update",id:"pr-update",level:2},{value:"Gitea",id:"gitea",level:2},{value:"Github",id:"github",level:2},{value:"GitLab",id:"gitlab",level:2},{value:"Json output",id:"json-output",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"release-pr",children:"release-pr"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"release-plz release-pr"})," command runs ",(0,t.jsx)(n.a,{href:"/docs/usage/update",children:(0,t.jsx)(n.code,{children:"release-plz update"})})," and\nopens a GitHub Pull Request that prepares the next release."]}),"\n",(0,t.jsx)(n.p,{children:"When the project maintainer merges the release pull request, the packages are\nready to be published."}),"\n",(0,t.jsxs)(n.p,{children:["Here's an example of a ",(0,t.jsx)(n.a,{href:"https://github.com/release-plz/release-plz/pull/377",children:"PR"}),"\nopened by release-plz in the release-plz GitHub project itself."]}),"\n",(0,t.jsxs)(n.p,{children:["In the following example, I run ",(0,t.jsx)(n.code,{children:"release-plz"})," on the ",(0,t.jsx)(n.code,{children:"release-plz"})," project\nitself.\n",(0,t.jsx)(n.code,{children:"Release-plz"})," opens a PR that increases the version and the changelog of the\npackages with unpublished changes."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://user-images.githubusercontent.com/11428655/160772903-544c7578-7c17-4311-b6ca-a1aefeabe799.gif",alt:"release-plz release-pr"})}),"\n",(0,t.jsxs)(n.p,{children:["To learn more, run ",(0,t.jsx)(n.code,{children:"release-plz release-pr --help"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"pr-update",children:"PR update"}),"\n",(0,t.jsx)(n.p,{children:"If there's already an open release PR:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If the PR contains commits that are not from bots (except the first one),\nrelease-plz closes the PR to preserve the git history.\nThe update mechanism is simple: overwrite everything and force-push. \ud83d\udca5\nReasoning: changes done by bots are not valuable, so we can overwrite them.\n(Not available on Gitea and GitLab)."}),"\n",(0,t.jsx)(n.li,{children:"Otherwise, release-plz closes the old PR and opens a new one.\nThis is done to preserve the git history of maintainers' changes.\nRelease-plz also closes the release PR when it cannot update it\n(for example, the force-push fails due to merge conflicts)."}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"release-plz release-pr -p <package>"})," doesn't open a PR per package.\nInstead, release-plz overrides the existing release PR with the changes of the specified package."]})}),"\n",(0,t.jsx)(n.h2,{id:"gitea",children:"Gitea"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"release-plz release-pr"})," also supports creating PRs for repositories hosted on\nGitea with the ",(0,t.jsx)(n.code,{children:"--forge"})," option:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"release-plz release-pr --git-token <gitea application token> --forge gitea"})}),"\n",(0,t.jsx)(n.p,{children:"The token needs to have the following permissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"read:repository"}),", ",(0,t.jsx)(n.code,{children:"write:repository"}),": to create the release PR."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"read:issue"}),", ",(0,t.jsx)(n.code,{children:"write:issue"}),": to add labels to the release PR."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"github",children:"Github"}),"\n",(0,t.jsxs)(n.p,{children:["On Github, the ",(0,t.jsx)(n.code,{children:"release-plz release-pr"})," will use your ",(0,t.jsx)(n.code,{children:"--git-token"})," to create a commit\nthrough the ",(0,t.jsx)(n.a,{href:"https://docs.github.com/en/graphql",children:"GraphQL API"})," rather\nthan making a commit locally and pushing the changes.\nThis allows having a ",(0,t.jsx)(n.a,{href:"https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification",children:"Verified"}),"\ncommit without specifying a GPG signature."]}),"\n",(0,t.jsx)(n.h2,{id:"gitlab",children:"GitLab"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"release-plz release-pr"})," also supports creating PRs for repositories hosted on GitLab with\nthe ",(0,t.jsx)(n.code,{children:"--forge gitlab"})," option."]}),"\n",(0,t.jsx)(n.p,{children:"You need to create a token in your GitLab repo (Settings/Access Tokens) with the following\npermissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Role: ",(0,t.jsx)(n.code,{children:"Maintainer"})," or higher"]}),"\n",(0,t.jsxs)(n.li,{children:["Scopes:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"api"})," (to read/create/update a release-pr)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"write_repository"})," (to push the release-plz branch)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["See the GitLab ",(0,t.jsx)(n.a,{href:"https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html",children:"project access tokens"}),"\ndocs."]}),"\n",(0,t.jsxs)(n.p,{children:["Then you can run ",(0,t.jsx)(n.code,{children:"release-plz release-pr"})," with the following arguments:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"release-plz release-pr --forge gitlab --git-token <gitlab_token>"})}),"\n",(0,t.jsx)(n.h2,{id:"json-output",children:"Json output"}),"\n",(0,t.jsxs)(n.p,{children:["You can get info about the outcome of this command by appending ",(0,t.jsx)(n.code,{children:"-o json"})," to the command:\nStdout will contain info about the release PR:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "prs": [\n    {\n      "head_branch": "<head_branch>",\n      "base_branch": "<base_branch>",\n      "html_url": "<html_url>",\n      "number": <pr_number>,\n      "releases": [\n        {\n          "package_name": "<package_name>",\n          "version": "<package_version>"\n        }\n      ]\n\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "prs": [\n    {\n      "head_branch": "release-plz-2024-04-03T21-57-37Z",\n      "base_branch": "main",\n      "html_url": "http://localhost:3000/zodpwlgr/xcpayeoa/pulls/1",\n      "number": 1,\n      "releases": [\n        {\n          "package_name": "my_package",\n          "version": "1.0.3"\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"prs"}),": An array of objects representing the opened PRs.\nIf release-plz didn't open or update a release PR, the ",(0,t.jsx)(n.code,{children:"prs"})," array will be empty."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"head_branch"}),": The name of the branch where the changes are implemented."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"base_branch"}),": name of the branch the changes are pulled into.\nIt is the default branch of the repository. E.g. ",(0,t.jsx)(n.code,{children:"main"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["At the moment, the ",(0,t.jsx)(n.code,{children:"release-plz release-pr"})," command doesn't support opening multiple PRs, but we\nplan to add this feature in the future."]})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);